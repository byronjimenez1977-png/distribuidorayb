<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Distribuidora A & B</title>
<style>
body{font-family:'Poppins',sans-serif;margin:0;background:linear-gradient(to bottom,#ccefff,#ffffff);}
header{background:linear-gradient(to right,#007bff,#00c6ff);color:#fff;text-align:center;padding:40px 20px;position:relative;}
header img{position:absolute;left:20px;top:20px;width:80px;height:80px;border-radius:50%;background:white;object-fit:cover;}
.envio{background:#34a853;color:white;text-align:center;padding:15px;font-weight:bold;}
.intro{text-align:center;background:white;margin:20px auto;padding:20px;border-radius:12px;width:90%;max-width:800px;box-shadow:0 2px 8px rgba(0,0,0,0.1);}
.promo{text-align:center;background:orange;color:white;padding:10px;margin:15px auto;width:90%;border-radius:10px;font-weight:bold;}
.filtros{text-align:center;margin:10px;}
.filtros input,.filtros select{padding:8px;border:1px solid #ccc;border-radius:8px;margin:5px;}
.productos{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;padding:20px;width:90%;margin:auto;}
.producto{background:white;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1);text-align:center;overflow:hidden;padding-bottom:15px;animation:fadein .7s ease forwards;}
@keyframes fadein{from{opacity:0;transform:translateY(30px);}to{opacity:1;transform:translateY(0);}}
.producto img{width:100%;height:200px;object-fit:cover;}
.btn-whatsapp{background:#25D366;color:white;padding:8px 12px;border-radius:8px;text-decoration:none;font-weight:bold;display:inline-block;margin-top:8px;}
.btn-whatsapp:hover{background:#1ebe5d;}
.whatsapp-fixed{position:fixed;bottom:20px;right:20px;background:#25D366;color:white;padding:12px 18px;border-radius:50px;text-decoration:none;font-size:16px;box-shadow:0 4px 8px rgba(0,0,0,0.2);display:flex;align-items:center;gap:8px;}
</style>
</head>
<body>
<header>
  <img src="logoAB.png" alt="Logo A&B">
  <h1>Distribuidora A & B</h1>
  <p>Pedidos rÃ¡pidos y fÃ¡ciles por WhatsApp ğŸ›’</p>
</header>

<div class="envio">ğŸšš Entrega GRATIS por compras mayores de Q150<br>ğŸ’µ Pedidos menores Q15 dentro de Huehuetenango</div>

<div class="intro">
  <h2>Â¡Bienvenidos a Distribuidora A & B!</h2>
  <p>Productos de limpieza <b>MAX Oxy</b> con calidad y precios accesibles.<br>
  ğŸ“ Mercado Las Victorias, Local No. 44 Zona 5 Huehuetenango.</p>
</div>

<div class="promo">ğŸ’¥ Â¡A mayoristas precios especiales! ğŸ’°</div>

<div class="filtros">
  <input type="text" id="busqueda" placeholder="Buscar producto...">
  <select id="categoria"><option value="">Todas las categorÃ­as</option></select>
</div>

<div id="productos" class="productos"></div>

<a href="https://wa.me/50247111160" target="_blank" class="whatsapp-fixed">ğŸ’¬ Hacer pedido ahora</a>

<script>
const sheetURL="https://docs.google.com/spreadsheets/d/e/2PACX-1vTDuTYvulCwesaBrL74caLRyCnPuBVAMWUSHzfyUelxzclArKYz0H1x6HY5gC0hL3ZPGqkJQbAxsU4D/pub?output=csv";
let productos=[];

// Limpieza y normalizaciÃ³n del enlace
function limpiarURL(url){
  if(!url)return "";
  let u=url.trim().replace(/['"]/g,"").replace(/(\r\n|\n|\r)/gm,"");
  if(u.includes("drive.google.com/uc?id=")) return u;
  if(u.includes("/file/d/")){let id=u.split("/file/d/")[1].split("/")[0];return "https://drive.google.com/uc?id="+id;}
  if(u.includes("download?id=")){let id=u.split("download?id=")[1].split("&")[0];return "https://drive.google.com/uc?id="+id;}
  if(u.includes("?id=")){let id=u.split("?id=")[1].split("&")[0];return "https://drive.google.com/uc?id="+id;}
  return u;
}

function mostrarProductos(txt="",cat=""){
  const cont=document.getElementById("productos");
  cont.innerHTML="";
  const filtrados=productos.filter(p=>{
    const coincideTxt=p.nombre.toLowerCase().includes(txt.toLowerCase());
    const coincideCat=cat===""||p.categoria===cat;
    return coincideTxt&&coincideCat;
  });
  filtrados.forEach(p=>{
    const div=document.createElement("div");
    div.className="producto";
    div.innerHTML=`
      <img src="${p.imagen}" onerror="this.src='encabezado.png';">
      <h3>${p.nombre}</h3>
      <p>Q${p.precio}</p>
      <a class="btn-whatsapp" href="https://wa.me/50247111160?text=Hola%20quiero%20${encodeURIComponent(p.nombre)}%20(Q${p.precio})" target="_blank">ğŸ›’ Pedir por WhatsApp</a>
    `;
    cont.appendChild(div);
  });
}

fetch(sheetURL)
.then(r=>r.text())
.then(t=>{
  const filas=t.split("\n").slice(1);
  const categorias=new Set();
  filas.forEach(f=>{
    const c=f.includes(";")?f.split(";"):f.split(",");
    if(c.length>=4){
      const categoria=c[0].trim();
      const nombre=c[1].replace(/"/g,"").trim();
      const precio=c[2].trim();
      const imagen=limpiarURL(c[3]);
      productos.push({categoria,nombre,precio,imagen});
      if(categoria)categorias.add(categoria);
    }
  });
  const sel=document.getElementById("categoria");
  categorias.forEach(ct=>{
    const o=document.createElement("option");
    o.value=ct;o.textContent=ct;sel.appendChild(o);
  });
  mostrarProductos();
});

document.getElementById("busqueda").addEventListener("input",e=>{
  mostrarProductos(e.target.value,document.getElementById("categoria").value);
});
document.getElementById("categoria").addEventListener("change",e=>{
  mostrarProductos(document.getElementById("busqueda").value,e.target.value);
});
</script>
</body>
</html>
